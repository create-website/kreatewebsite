<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Model Context Protocol: An Architectural Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .prose-headings {
            scroll-margin-top: 4rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Mobile Menu Toggle Button -->
    <button id="menu-toggle" class="lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-md shadow-lg text-slate-600 hover:text-slate-900">
        <svg id="menu-open-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        <svg id="menu-close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>
    
    <!-- Overlay for mobile menu -->
    <div id="overlay" class="lg:hidden fixed inset-0 bg-black/50 z-30 hidden"></div>

    <div class="flex">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="fixed top-0 left-0 h-screen w-80 bg-white border-r border-slate-200 overflow-y-auto p-8 shrink-0 z-40 -translate-x-full lg:translate-x-0 lg:sticky transition-transform duration-300 ease-in-out">
            <h2 class="text-sm font-semibold text-slate-900 tracking-tight mb-4">Contents</h2>
            <nav id="sidebar-nav">
                <ul class="space-y-3">
                    <!-- Navigation links will be dynamically populated by JS -->
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 sm:p-8 lg:p-12">
            <div class="max-w-4xl mx-auto">
                <header class="mb-12 pb-6 border-b border-slate-200">
                    <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-slate-900">The Model Context Protocol</h1>
                    <p class="mt-4 text-xl text-slate-600">A Definitive Architectural Analysis for Agentic AI Systems</p>
                </header>

                <div id="content-sections" class="prose prose-slate max-w-none prose-h2:text-2xl prose-h3:text-xl prose-h4:text-lg prose-h2:font-semibold prose-h3:font-semibold prose-h4:font-semibold">
                    
                    <!-- Part I -->
                    <section id="part1" class="prose-headings">
                        <h2 class="flex items-center justify-between cursor-pointer group">
                            <span>Part I: The Foundational Layer</span>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-slate-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h2>
                        <div class="collapsible-content">
                            <p>This part establishes the fundamental "what" and "why" of the Model Context Protocol (MCP), deconstructing its core architecture and communication protocols. It serves as the technical bedrock for the strategic analysis in later sections.</p>
                            
                            <article id="section1" class="prose-headings">
                                <h3>Section 1: Introduction to the Model Context Protocol (MCP)</h3>
                                
                                <div id="section1-1" class="prose-headings">
                                    <h4>1.1 The Genesis of MCP: Solving the M×N Integration Problem</h4>
                                    <p>The proliferation of capable Large Language Models (LLMs) has catalyzed the development of agentic AI systems—autonomous programs that can reason, plan, and execute tasks on behalf of users. Historically, this required bespoke integrations, leading to the "M×N integration problem".</p>
                                    <p>The Model Context Protocol (MCP) transforms this into a more scalable M+N problem by defining a standardized, universal interface, fostering a modular and interoperable ecosystem for agentic AI.</p>
                                </div>
                                
                                <div id="section1-2" class="prose-headings">
                                    <h4>1.2 Core Analogy: The "USB-C Port for AI"</h4>
                                    <p>MCP is often described as a "USB-C port for AI applications". It provides a standardized software interface designed for the iterative and conversational nature of agentic workflows, contrasting with stateless standards like REST or GraphQL.</p>
                                </div>

                                <div id="section1-3" class="prose-headings">
                                    <h4>1.3 Architectural Overview: The Host, Client, and Server Trinity</h4>
                                    <p>MCP's architecture consists of three core components:</p>
                                    <ul>
                                        <li><strong>MCP Host:</strong> The user-facing AI application (e.g., VS Code) that orchestrates logic and user consent.</li>
                                        <li><strong>MCP Client:</strong> An embedded component for protocol communication with a server.</li>
                                        <li><strong>MCP Server:</strong> A "smart adapter" for an external tool or data source.</li>
                                    </ul>
                                </div>
                            </article>

                            <article id="section2" class="prose-headings">
                                <h3>Section 2: The Primitives of Agentic Interaction</h3>
                                 <p>MCP defines core primitives to structure agent interactions:</p>
                                 <ul>
                                     <li><strong>Tools:</strong> Executable functions an agent can invoke.</li>
                                     <li><strong>Resources:</strong> File-like data for context, accessible via URI.</li>
                                     <li><strong>Prompts:</strong> Reusable, user-controlled templates for complex tasks.</li>
                                     <li><strong>Advanced Primitives:</strong> Mechanisms (Sampling, Elicitation) for bidirectional server-client communication.</li>
                                 </ul>
                            </article>

                            <article id="section3" class="prose-headings">
                                 <h3>Section 3: The Communication Lifecycle</h3>
                                 <p>MCP is a stateful protocol with a three-phase lifecycle: 1) Initialization and Capability Negotiation, 2) Operational Loop using JSON-RPC 2.0, and 3) Graceful Shutdown. It supports transports like <strong>stdio</strong> and <strong>HTTP + SSE</strong>.</p>
                            </article>
                        </div>
                    </section>

                    <!-- Part II -->
                    <section id="part2" class="prose-headings">
                        <h2 class="flex items-center justify-between cursor-pointer group">
                           <span>Part II: The Practical Layer</span>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-slate-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h2>
                        <div class="collapsible-content">
                            <p>This part transitions from the theoretical underpinnings of the protocol to the practical realities of building, deploying, and utilizing MCP servers.</p>

                            <article id="section4" class="prose-headings">
                                <h3>Section 4: Developing MCP Servers and Clients</h3>
                                 <p>The ecosystem is supported by SDKs for Python, TypeScript, Java, C#, and Go. Client-side integration is simplified in IDEs like VS Code and Cursor.</p>
                                <pre class="bg-slate-900 text-white rounded-lg p-4 overflow-x-auto text-sm"><code># Conceptual client-side integration
from agents import Agent
from agents.mcp import MCPServerStdio

filesystem_server = MCPServerStdio(
    params={
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/workspace"],
    })

agent = Agent(name="Assistant", mcp_servers=[filesystem_server])</code></pre>
                            </article>

                            <article id="section5" class="prose-headings">
                                <h3>Section 5: The Open Source Landscape</h3>
                                <p>A vibrant open-source ecosystem provides pre-built servers, while platforms like mcpmarket.com act as "app stores." Tools like the MCP Inspector aid in development.</p>
                            </article>
                        </div>
                    </section>

                    <!-- Part III -->
                    <section id="part3" class="prose-headings">
                         <h2 class="flex items-center justify-between cursor-pointer group">
                            <span>Part III: The Architectural Layer</span>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-slate-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h2>
                        <div class="collapsible-content">
                            <p>This part analyzes how MCP functions as a fundamental building block for different types of AI agent architectures.</p>
                            <article id="section6" class="prose-headings">
                                <h3>Section 6: Empowering Single-Agent Architectures</h3>
                                <p>MCP provides a model-agnostic standard for tool use and enables externalized long-term memory via Resources, overcoming LLM context window limitations.</p>
                            </article>
                            <article id="section7" class="prose-headings">
                                <h3>Section 7: Enabling Multi-Agent Systems (MAS)</h3>
                                <p>MCP can function as a <strong>shared workspace</strong> (similar to a Blackboard architecture) or enable an <strong>"Agent-as-a-Tool"</strong> paradigm for hierarchical agent systems.</p>
                            </article>
                            <article id="section8" class="prose-headings">
                                <h3>Section 8: The Protocol Interoperability Matrix</h3>
                                <p>MCP is a <strong>vertical</strong> protocol for execution, while the Agent-to-Agent (A2A) protocol is a <strong>horizontal</strong> protocol for coordination. Sophisticated systems use both.</p>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left border-collapse">
                                        <!-- Table content remains the same -->
                                        <thead class="bg-slate-100">
                                        <tr>
                                            <th class="p-3 font-semibold border border-slate-300">Feature Dimension</th>
                                            <th class="p-3 font-semibold border border-slate-300">Model Context Protocol (MCP)</th>
                                            <th class="p-3 font-semibold border border-slate-300">Agent-to-Agent (A2A) Protocol</th>
                                            <th class="p-3 font-semibold border border-slate-300">Blackboard System</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-t border-slate-200">
                                            <td class="p-3 border border-slate-300 font-medium">Primary Paradigm</td>
                                            <td class="p-3 border border-slate-300">Client-Server (Vertical, Centralized)</td>
                                            <td class="p-3 border border-slate-300">Peer-to-Peer (Horizontal, Decentralized)</td>
                                            <td class="p-3 border border-slate-300">Shared Repository (Indirect, Centralized)</td>
                                        </tr>
                                        <tr class="bg-slate-50 border-t border-slate-200">
                                            <td class="p-3 border border-slate-300 font-medium">Core Function</td>
                                            <td class="p-3 border border-slate-300">Agent-to-Tool/Data Interaction (Execution)</td>
                                            <td class="p-3 border border-slate-300">Agent-to-Agent Coordination (Orchestration)</td>
                                            <td class="p-3 border border-slate-300">Collaborative, Emergent Problem-Solving</td>
                                        </tr>
                                        <tr class="border-t border-slate-200">
                                            <td class="p-3 border border-slate-300 font-medium">Key Use Case</td>
                                            <td class="p-3 border border-slate-300">Standardizing tool access for a single agent or a hierarchy.</td>
                                            <td class="p-3 border border-slate-300">Task delegation and negotiation between autonomous peers.</td>
                                            <td class="p-3 border border-slate-300">Complex problems where the solution path is unknown.</td>
                                        </tr>
                                    </tbody>
                                    </table>
                                </div>
                            </article>
                        </div>
                    </section>
                    
                    <!-- Part IV -->
                    <section id="part4" class="prose-headings">
                        <h2 class="flex items-center justify-between cursor-pointer group">
                           <span>Part IV: The Enterprise Layer</span>
                           <svg class="w-5 h-5 text-slate-400 group-hover:text-slate-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h2>
                        <div class="collapsible-content">
                            <article id="section9" class="prose-headings">
                               <h3>Section 9: Engineering for Scale and Resilience</h3>
                               <p>Enterprise-grade MCP services require stateless server design, containerization, orchestration with Kubernetes, and auto-scaling for high availability.</p>
                            </article>
                            <article id="section10" class="prose-headings">
                               <h3>Section 10: Security and Governance</h3>
                               <p>Key vulnerabilities include prompt injection and tool deception. Mitigation requires a defense-in-depth strategy: input sanitization, sandboxing, least privilege, and robust auditing.</p>
                            </article>
                            <article id="section11" class="prose-headings">
                               <h3>Section 11: Real-World Adoption</h3>
                               <p>Companies like Block, GitHub, and Stripe use MCP to enhance productivity. Key lessons are that security is paramount and driving adoption requires a concerted effort.</p>
                            </article>
                        </div>
                    </section>
                    
                    <!-- Part V -->
                    <section id="part5" class="prose-headings">
                        <h2 class="flex items-center justify-between cursor-pointer group">
                           <span>Part V: The Strategic Layer</span>
                           <svg class="w-5 h-5 text-slate-400 group-hover:text-slate-600 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </h2>
                        <div class="collapsible-content">
                             <article id="section12" class="prose-headings">
                               <h3>Section 12: The Trajectory of the MCP Standard</h3>
                               <p>Future trends include <strong>MCP Gateways</strong> for centralized security, <strong>autonomous discovery</strong> of servers, and support for <strong>multimodal context</strong>.</p>
                            </article>

                            <article id="section13" class="prose-headings">
                               <h3>Section 13: Strategic Recommendations and Conclusion</h3>
                               <p>Adopt MCP for applications needing to interact with multiple tools, support different AI models, and build a reusable ecosystem of AI capabilities.</p>
                               <h4>Concluding Analysis</h4>
                               <p>MCP is a fundamental architectural shift, bridging LLM cognition with real-world action. Its rapid adoption signals its emergence as a foundational piece of the modern AI stack.</p>
                            </article>
                        </div>
                    </section>
                </div>

                <footer id="works-cited" class="prose-headings mt-16 pt-8 border-t border-slate-200">
                    <h2 class="text-2xl font-semibold">Works Cited</h2>
                    <ul class="list-disc pl-5 text-sm space-y-2">
                        <!-- Works cited will be populated by JS -->
                    </ul>
                </footer>
            </div>
        </main>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const content = document.getElementById('content-sections');
        const sidebarNav = document.getElementById('sidebar-nav').querySelector('ul');
        const worksCitedList = document.getElementById('works-cited').querySelector('ul');
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuOpenIcon = document.getElementById('menu-open-icon');
        const menuCloseIcon = document.getElementById('menu-close-icon');

        // --- Populate Sidebar Navigation ---
        let mainList = document.createElement('ul');
        mainList.className = 'space-y-2';
        
        const sections = content.querySelectorAll('section');
        sections.forEach(section => {
            const partTitle = section.querySelector('h2 > span');
            if (partTitle) {
                const partLi = document.createElement('li');
                const partLink = document.createElement('a');
                partLink.href = `#${section.id}`;
                partLink.textContent = partTitle.textContent;
                partLink.className = 'block font-semibold text-slate-700 hover:text-sky-600 transition-colors';
                partLi.appendChild(partLink);

                const articles = section.querySelectorAll('article');
                if (articles.length > 0) {
                    const subList = document.createElement('ul');
                    subList.className = 'pl-4 mt-2 space-y-1';
                    articles.forEach(article => {
                        const articleTitle = article.querySelector('h3');
                        if (articleTitle) {
                            const articleLi = document.createElement('li');
                            const articleLink = document.createElement('a');
                            articleLink.href = `#${article.id}`;
                            articleLink.textContent = articleTitle.textContent;
                            articleLink.className = 'block text-sm text-slate-600 hover:text-sky-600 transition-colors';
                            articleLi.appendChild(articleLink);
                            subList.appendChild(articleLi);
                        }
                    });
                    partLi.appendChild(subList);
                }
                mainList.appendChild(partLi);
            }
        });

        // Add Works Cited link
        const worksCitedLi = document.createElement('li');
        const worksCitedLink = document.createElement('a');
        worksCitedLink.href = '#works-cited';
        worksCitedLink.textContent = 'Works Cited';
        worksCitedLink.className = 'block font-semibold text-slate-700 hover:text-sky-600 transition-colors pt-2 border-t border-slate-200 mt-2';
        worksCitedLi.appendChild(worksCitedLink);
        mainList.appendChild(worksCitedLi);

        sidebarNav.appendChild(mainList);
        
        // --- Populate Works Cited ---
        const citations = [ "Agentic AI: Model Context Protocol, A2A, and automation's future - Dynatrace", "What is the Model Context Protocol (MCP)? - Cloudflare", "MCP Explained: The New Standard Connecting AI to Everything | by Edwin Lisowski", "What Is the Model Context Protocol (MCP) and How It Works - Descope", "MCP: the Universal Connector for Building Smarter, Modular AI Agents - InfoQ", "Model Context Protocol: What You Need To Know - Gradient Flow", "Model Context Protocol - Wikipedia", "Model context protocol (MCP) - OpenAI Agents SDK", "What is MCP in AI and How it Works? - Prismetric", "Model Context Protocol : Clearly Explained! | by Pankaj Tiwari | Accredian - Medium", "What is MCP (Model Context Protocol)? - Zapier", "Lifecycle - Model Context Protocol", "What is Model Context Protocol (MCP): Explained - Composio", "AI Spotlight: MCP (Model Context Protocol) and Agentic AI systems - Gravitee", "What is MCP in AI and Its Benefits - Aalpha Information Systems", "MCP Servers:A Comprehensive Guide - viaSocket", "Use MCP servers in VS Code", "Unlocking the Future of AI: A Deep Dive into the Model Context Protocol (MCP) - DEV Community", "How to build a simple agentic AI server with MCP | Red Hat Developer", "Server Concepts - Model Context Protocol", "Model Context Protocol (MCP) Server in Enterprises - TrueFoundry", "MCP 101: An Introduction to Model Context Protocol - DigitalOcean", "Architecture Overview - Model Context Protocol", "Advancing Multi-Agent Systems Through Model Context Protocol... - arXiv", "Extend your agent with Model Context Protocol - Microsoft Copilot Studio", "Specification - Model Context Protocol", "The Model Context Protocol: Getting beneath the hype | Thoughtworks India", "A Survey of Agent Interoperability Protocols... - arXiv", "Understanding Model Context Protocol... | by Plaban Nayak | The AI Forum | Medium", "Understanding the Model Context Protocol (MCP): Architecture - Nebius", "Model Context Protocol (MCP) · Cloudflare Agents docs", "Unlocking the power of Model Context Protocol (MCP) on AWS | Artificial Intelligence", "The Future of Model Context Protocol... - SuperAGI", "Shortcomings of Model Context Protocol (MCP) Explained - CData Software", "Understand the Model Context Protocol or MCP once and for all - Coffee bytes", "Model Context Protocol - GitHub", "The official Python SDK for Model Context Protocol servers and clients - GitHub", "@modelcontextprotocol/sdk - npm", "Java SDK Overview - Model Context Protocol", "Using the GitHub MCP Server", "GitHub's official MCP Server", "How to Use Slack MCP Server Effortlessly - Apidog", "Slack - MCP Server - Cursor Directory", "Google Drive - MCP Server - Cursor Directory", "How to use Slack MCP server with Claude flawlessly - Composio", "modelcontextprotocol/servers: Model Context Protocol Servers - GitHub", "punkpeye/awesome-mcp-servers: A collection of MCP servers. - GitHub", "Awesome MCP Servers - A curated list of Model Context Protocol servers - GitHub", "A practical guide on how to use the GitHub MCP server", "github-mcp-server is now available in public preview - GitHub Changelog", "MCP Marketplaces: Real Case Studies on AI Automation & Integration - ColorWhistle", "korotovsky/slack-mcp-server... - GitHub", "Instantly Connect Your Slack AI Agent with MCP - Runbear", "awslabs/mcp: AWS MCP Servers... - GitHub", "A Deep Dive Into MCP and the Future of AI Tooling | Andreessen Horowitz", "Advancing Multi-Agent Systems Through Model Context Protocol... - ResearchGate", "The Model Context Protocol (MCP): A New Standard for Multi-Agent Intelligence... | by Harun Raseed Basheer | Medium", "MCP vs A2A... : r/AI_Agents - Reddit", "Building Intelligent Multi-Agent Systems with MCPs and the Blackboard Pattern... | by Denis Petelin | Medium", "Four Design Patterns for Event-Driven, Multi-Agent Systems - Confluent", "Blackboard system - Wikipedia", "Exploring Advanced LLM Multi-Agent Systems Based on Blackboard Architecture - arXiv", "The Blackboard Pattern: A Framework for Complex Problem Solving - DEV Community", "Blackboard Architecture... | by Platform sharks - Medium", "The Agent-as-Tool Antipattern... | by Kishore Gopalan | Google Cloud - Community | Medium", "Deploying multi-agent systems using MCP and A2A with Claude on Vertex AI - Anthropic", "MCP vs. A2A: Which AI agent protocol should you use? - WorkOS", "When to Choose a Single Agent + MCP or Multi Agent + A2A - CData Software", "MCP vs A2A: A Guide to AI Agent Communication Protocols - Auth0", "Daily Papers - Hugging Face (Micro-protocols)", "Daily Papers - Hugging Face (Coral Protocol)", "[2505.02279] A survey of agent interoperability protocols... - arXiv", "Comparative Analysis of Open-Source Agent Communication Protocols... | by Shan Chang | Medium", "MCP Horizontal Scaling: Optimize Scalability in 2025 - BytePlus", "7 MCP Server Best Practices for Scalable AI Integrations in 2025 - MarkTechPost", "Can Model Context Protocol (MCP) scale to support hundreds of simultaneous users? - Milvus", "MCP Server Scalability: Essential Tips for Infrastructure Growth - Arsturn", "Enterprise ready MCP servers... - WorkOS", "MCP Horror Stories... - Docker", "MCP Security Exposed... | Palo Alto Networks", "Model Context Protocol (MCP): Understanding security risks and controls - Red Hat", "Top 10 MCP Security Risks You Need to Know - Prompt Security", "The Security Risks of Model Context Protocol (MCP) - Pillar Security", "Plug, Play, and Prey: The security risks of the Model Context Protocol - Microsoft Tech Community", "how to build secure and scalable MCP (Model Context Protocol) servers - Reddit", "Enterprise Challenges With MCP Adoption - Christian Posta", "MCP in the Enterprise: Real World Adoption at Block | codename goose", "Successful Implementation of MCP Servers in Businesses - Arsturn", "MCP vs Custom Integrations... - SuperAGI", "Some Thoughts on MCP Servers... : r/ClaudeAI - Reddit", "MCP Use Cases... | Coupler.io Blog", "What are your biggest challenges when creating and using MCP server... : r/AI_Agents - Reddit", "The Model Context Protocol (MCP) in AI... | by TechTopia" ];
        citations.forEach(text => { worksCitedList.appendChild(Object.assign(document.createElement('li'), {textContent: text})); });

        // --- Mobile Menu Toggle ---
        function toggleMenu() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
            menuOpenIcon.classList.toggle('hidden');
            menuCloseIcon.classList.toggle('hidden');
        }
        menuToggle.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);

        // --- Collapsible Sections ---
        content.querySelectorAll('section > h2').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('svg');
                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            });
            // Collapse by default, except for the first part
            if (header.parentElement.id !== 'part1') {
                 header.click();
            }
        });

        // --- Intersection Observer for Active Nav Link ---
        const navLinks = sidebarNav.querySelectorAll('a');
        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.3 };
        const observerCallback = (entries) => {
            entries.forEach(entry => {
                const href = `#${entry.target.id}`;
                const link = sidebarNav.querySelector(`a[href="${href}"]`);
                if (entry.isIntersecting && link) {
                    navLinks.forEach(l => {
                        l.classList.remove('text-sky-600', 'font-bold');
                        l.parentElement.closest('li')?.querySelector('a')?.classList.remove('text-sky-600', 'font-bold');
                    });
                    link.classList.add('text-sky-600', 'font-bold');
                    const parentLink = link.parentElement.closest('ul.pl-4')?.parentElement.querySelector('a');
                    if (parentLink) {
                        parentLink.classList.add('text-sky-600', 'font-bold');
                    }
                }
            });
        };
        const observer = new IntersectionObserver(observerCallback, observerOptions);
        content.querySelectorAll('.prose-headings').forEach(section => observer.observe(section));
    });
</script>

</body>
</html>