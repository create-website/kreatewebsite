<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Causal Inference</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Paper & Ink) -->
    <!-- Application Structure Plan: The application is a thematic journey. It starts with an intro, moves to the core challenge (Correlation vs. Causation), and now includes a new infographic to visually summarize the path to causal claims. It then details core methods, provides a hands-on DAG Lab, and culminates in a new interactive quiz to reinforce learning. This structure builds understanding progressively: see the problem, get a visual summary, learn the tools, apply the tools, test your knowledge, and finally, consider the challenges. -->
    <!-- Visualization & Content Choices: 
        - Correlation vs. Causation: Report Info -> Spurious correlation. Goal -> Differentiate. Viz -> Scatter plot. Interaction -> Toggle confounder. Justification -> Visually demonstrates a confounding variable. Library -> Chart.js.
        - Infographic: Goal -> Summarize the causal reasoning process. Viz -> Vertical timeline built with HTML/CSS. Interaction -> None (static visual). Justification -> Provides a quick, memorable overview of the key steps, acting as a mental model for the user. Library/Method -> Tailwind CSS.
        - Core Methods (DiD, RDD, etc.): Goal -> Explain specific techniques. Viz -> Line/Scatter charts and diagrams. Interaction -> Buttons/Hover. Justification -> Each visualization is tailored to explain the specific logic of the method. Library -> Chart.js, Tailwind CSS.
        - DAG Lab: Goal -> Apply knowledge of causal structures. Viz -> Interactive canvas. Interaction -> Click to create nodes/arrows. Justification -> Hands-on practice solidifies understanding of causal assumptions. Library/Method -> Vanilla JS.
        - Quiz: Goal -> Assess understanding. Viz -> Multiple-choice questions. Interaction -> Select answers, get immediate feedback, see final score. Justification -> An effective way to engage the user and reinforce the key learning objectives from the guide. Library/Method -> Vanilla JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3 { font-family: 'Lora', serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            height: 350px;
            margin: auto;
        }
        @media (max-width: 768px) {
            .chart-container { height: 300px; }
        }
        .nav-link {
            transition: color 0.3s ease, border-bottom-color 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #1e3a8a;
            border-bottom-color: #1e3a8a;
        }
        .tab.active { background-color: #3b82f6; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .dag-node {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .dag-node.selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
            border-color: #3b82f6;
        }
        #dag-canvas-container {
            position: relative;
            background-image: radial-gradient(#d1d5db 1px, transparent 0);
            background-size: 20px 20px;
            min-height: 400px;
        }
        .quiz-option { transition: all 0.2s ease; }
        .quiz-option.correct { background-color: #10b981; color: white; border-color: #059669; }
        .quiz-option.incorrect { background-color: #ef4444; color: white; border-color: #dc2626; }
        .quiz-option:not(.disabled):hover { background-color: #e5e7eb; }
        .quiz-option.disabled { cursor: not-allowed; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-2xl font-bold text-gray-900">Unveiling Cause & Effect</h1>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#intro" class="nav-link text-gray-600 font-semibold pb-1">Intro</a>
                    <a href="#correlation" class="nav-link text-gray-600 font-semibold pb-1">Correlation</a>
                    <a href="#infographic" class="nav-link text-gray-600 font-semibold pb-1">Infographic</a>
                    <a href="#methods" class="nav-link text-gray-600 font-semibold pb-1">Methods</a>
                    <a href="#lab" class="nav-link text-gray-600 font-semibold pb-1">Lab</a>
                    <a href="#quiz" class="nav-link text-gray-600 font-semibold pb-1">Quiz</a>
                    <a href="#challenges" class="nav-link text-gray-600 font-semibold pb-1">Challenges</a>
                </div>
                 <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500">
                    <span class="sr-only">Open main menu</span>
                    &#9776;
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#intro" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Intro</a>
                <a href="#correlation" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Correlation</a>
                <a href="#infographic" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Infographic</a>
                <a href="#methods" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Methods</a>
                <a href="#lab" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Lab</a>
                <a href="#quiz" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Quiz</a>
                <a href="#challenges" class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50">Challenges</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <section id="intro" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-4">From Association to Understanding</h2>
            <p class="max-w-3xl mx-auto text-center text-lg text-gray-600">
                In a world overflowing with data, we see patterns everywhere. But which patterns signify a true cause-and-effect relationship? Causal inference is the science that helps us move beyond simple correlation to determine if a specific action or intervention is the actual cause of an observed outcome. This guide provides an interactive journey into its core ideas, helping you understand how we can confidently answer "why" questions.
            </p>
        </section>

        <hr class="my-16 border-gray-200">

        <section id="correlation" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-2">Correlation vs. Causation</h2>
            <p class="max-w-3xl mx-auto text-center text-lg text-gray-600 mb-8">
                The most famous mantra in data analysis is "correlation does not imply causation." Two variables can be strongly related without one causing the other. Often, a hidden third factor, a <span class="font-semibold text-blue-600">confounding variable</span>, is the true cause. Let's explore this with a classic example.
            </p>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <div class="chart-container">
                    <canvas id="correlationChart"></canvas>
                </div>
                <div class="text-center mt-6">
                    <button id="confounder-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                        Reveal Confounding Variable
                    </button>
                </div>
                <div id="explanation-text" class="mt-4 text-center text-gray-700 max-w-2xl mx-auto hidden">
                    <h3 class="font-bold text-xl mb-2 text-red-600">The Confounder: High Temperatures!</h3>
                    <p>Hot weather is the <span class="font-semibold">confounding variable</span>. High temperatures cause both ice cream sales to rise and, unfortunately, more people to go swimming, which can lead to more shark encounters. Ice cream sales don't cause shark attacks; the heat influences both independently. This is a classic example of a <span class="font-semibold">spurious correlation</span>.</p>
                </div>
            </div>
        </section>
        
        <hr class="my-16 border-gray-200">

        <section id="infographic" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-2">The Path to a Causal Claim</h2>
            <p class="max-w-3xl mx-auto text-center text-lg text-gray-600 mb-12">This visual guide summarizes the journey from a simple observation to a robust causal conclusion.</p>
            <div class="relative max-w-2xl mx-auto">
                <!-- The vertical line -->
                <div class="absolute left-1/2 top-0 h-full w-0.5 bg-gray-300 hidden sm:block"></div>
                <!-- Infographic Items -->
                <div class="space-y-12 sm:space-y-0">
                    <!-- Item 1 -->
                    <div class="sm:grid sm:grid-cols-2 sm:gap-x-8 items-center">
                        <div class="text-center sm:text-right">
                            <div class="text-5xl text-blue-500">1.</div>
                            <h3 class="text-2xl font-bold mt-2">Observe a Pattern</h3>
                        </div>
                        <div class="mt-4 sm:mt-0 relative">
                            <div class="absolute -left-4 top-1/2 -translate-y-1/2 h-8 w-8 bg-blue-500 rounded-full hidden sm:flex items-center justify-center text-white font-bold">1</div>
                            <p class="p-4 bg-white rounded-lg shadow-md sm:ml-8">You notice a correlation: when X happens, Y also seems to happen. For example, cities with more libraries have lower crime rates.</p>
                        </div>
                    </div>
                    <!-- Item 2 -->
                    <div class="sm:grid sm:grid-cols-2 sm:gap-x-8 items-center mt-12">
                        <div class="sm:col-start-2 text-center sm:text-left">
                             <div class="text-5xl text-purple-500">2.</div>
                            <h3 class="text-2xl font-bold mt-2">Question Everything</h3>
                        </div>
                        <div class="sm:col-start-1 sm:row-start-1 mt-4 sm:mt-0 relative">
                             <div class="absolute -right-4 top-1/2 -translate-y-1/2 h-8 w-8 bg-purple-500 rounded-full hidden sm:flex items-center justify-center text-white font-bold">2</div>
                            <p class="p-4 bg-white rounded-lg shadow-md sm:mr-8 text-right sm:text-left">Does X really cause Y? Could Y cause X? Or could something else entirely be causing both? This is the crucial step of critical thinking.</p>
                        </div>
                    </div>
                    <!-- Item 3 -->
                    <div class="sm:grid sm:grid-cols-2 sm:gap-x-8 items-center mt-12">
                        <div class="text-center sm:text-right">
                             <div class="text-5xl text-red-500">3.</div>
                            <h3 class="text-2xl font-bold mt-2">Identify Confounders</h3>
                        </div>
                        <div class="mt-4 sm:mt-0 relative">
                            <div class="absolute -left-4 top-1/2 -translate-y-1/2 h-8 w-8 bg-red-500 rounded-full hidden sm:flex items-center justify-center text-white font-bold">3</div>
                            <p class="p-4 bg-white rounded-lg shadow-md sm:ml-8">Search for hidden variables. For the library example, a city's wealth could be a confounder. Wealthier cities can afford more libraries AND more police, both of which reduce crime.</p>
                        </div>
                    </div>
                     <!-- Item 4 -->
                    <div class="sm:grid sm:grid-cols-2 sm:gap-x-8 items-center mt-12">
                        <div class="sm:col-start-2 text-center sm:text-left">
                             <div class="text-5xl text-green-500">4.</div>
                            <h3 class="text-2xl font-bold mt-2">Apply a Method</h3>
                        </div>
                        <div class="sm:col-start-1 sm:row-start-1 mt-4 sm:mt-0 relative">
                             <div class="absolute -right-4 top-1/2 -translate-y-1/2 h-8 w-8 bg-green-500 rounded-full hidden sm:flex items-center justify-center text-white font-bold">4</div>
                            <p class="p-4 bg-white rounded-lg shadow-md sm:mr-8 text-right sm:text-left">Use a rigorous technique (like DiD or RDD) to control for confounders and isolate the relationship between your specific treatment and outcome.</p>
                        </div>
                    </div>
                     <!-- Item 5 -->
                     <div class="sm:grid sm:grid-cols-2 sm:gap-x-8 items-center mt-12">
                        <div class="text-center sm:text-right">
                             <div class="text-5xl text-yellow-500">5.</div>
                            <h3 class="text-2xl font-bold mt-2">Make a Causal Claim</h3>
                        </div>
                        <div class="mt-4 sm:mt-0 relative">
                            <div class="absolute -left-4 top-1/2 -translate-y-1/2 h-8 w-8 bg-yellow-500 rounded-full hidden sm:flex items-center justify-center text-white font-bold">5</div>
                            <p class="p-4 bg-white rounded-lg shadow-md sm:ml-8">After rigorous analysis, you can make a qualified causal statement, acknowledging your assumptions. "Our analysis suggests X has a causal effect on Y, after accounting for Z."</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="my-16 border-gray-200">

        <section id="methods" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-2">Core Methods of Causal Inference</h2>
            <p class="max-w-3xl mx-auto text-center text-lg text-gray-600 mb-8">
                When randomization isn't possible, researchers use clever methods to estimate causal effects from observational data. Here are some of the most powerful approaches.
            </p>
            <div class="bg-white p-2 sm:p-4 rounded-lg shadow-lg">
                <div class="flex flex-wrap justify-center border-b border-gray-200 mb-4">
                    <button class="tab active py-2 px-4 m-1 rounded-t-lg font-semibold" data-tab="rct">RCTs</button>
                    <button class="tab py-2 px-4 m-1 rounded-t-lg font-semibold" data-tab="did">Difference-in-Differences</button>
                    <button class="tab py-2 px-4 m-1 rounded-t-lg font-semibold" data-tab="rdd">Regression Discontinuity</button>
                    <button class="tab py-2 px-4 m-1 rounded-t-lg font-semibold" data-tab="iv">Instrumental Variables</button>
                </div>

                <div id="rct" class="tab-content active p-4">
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Randomized Controlled Trials (RCTs)</h3>
                    <p class="text-gray-600 mb-6">Considered the "gold standard," RCTs randomly assign subjects to a treatment or a control group. By randomizing, we ensure that, on average, the only difference between the groups is the treatment itself, eliminating confounding. Any difference in outcomes can then be attributed to the treatment.</p>
                    <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-8 text-center">
                        <div class="p-4 bg-gray-100 rounded-lg"><strong>Population</strong></div>
                        <div class="text-2xl text-blue-500 font-bold">&rarr;</div>
                        <div class="p-4 bg-gray-100 rounded-lg"><strong>Random Assignment</strong></div>
                        <div class="text-2xl text-blue-500 font-bold">&rarr;</div>
                        <div class="space-y-2">
                           <div class="p-4 bg-green-100 rounded-lg border-l-4 border-green-500"><strong>Treatment Group</strong></div>
                           <div class="p-4 bg-red-100 rounded-lg border-l-4 border-red-500"><strong>Control Group</strong></div>
                        </div>
                        <div class="text-2xl text-blue-500 font-bold">&rarr;</div>
                        <div class="p-4 bg-yellow-100 rounded-lg border-l-4 border-yellow-500"><strong>Compare Outcomes</strong></div>
                    </div>
                </div>

                <div id="did" class="tab-content p-4">
                     <h3 class="text-2xl font-bold text-gray-800 mb-3">Difference-in-Differences (DiD)</h3>
                    <p class="text-gray-600 mb-6">DiD is a powerful quasi-experimental method. It compares the change in outcomes over time between a treatment group and a control group. We assume that without the intervention, both groups would have followed similar trends. The "difference in the differences" of their outcomes before and after the treatment is our estimated causal effect.</p>
                    <div class="chart-container">
                        <canvas id="didChart"></canvas>
                    </div>
                    <div class="text-center mt-6">
                        <button id="did-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Apply Intervention</button>
                        <button id="did-reset-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ml-2">Reset</button>
                    </div>
                </div>

                <div id="rdd" class="tab-content p-4">
                     <h3 class="text-2xl font-bold text-gray-800 mb-3">Regression Discontinuity (RDD)</h3>
                    <p class="text-gray-600 mb-6">RDD is used when a treatment is assigned based on a specific cutoff or threshold (e.g., students with a test score above 80 receive a scholarship). By comparing the outcomes of individuals just above and just below this threshold, we can estimate the causal effect of the treatment, assuming these individuals are otherwise very similar.</p>
                    <div class="chart-container">
                        <canvas id="rddChart"></canvas>
                    </div>
                </div>

                <div id="iv" class="tab-content p-4">
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Instrumental Variables (IV)</h3>
                    <p class="text-gray-600 mb-6">IV is a method used when there's unobserved confounding between a treatment and an outcome. It requires finding an "instrument" — a variable that affects the treatment choice but doesn't directly affect the outcome, except through its effect on the treatment. This allows us to isolate the part of the treatment that is "as good as random" and use it to estimate the causal effect.</p>
                     <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4 text-center p-6 bg-gray-50 rounded-lg">
                        <div class="p-4 bg-purple-100 rounded-lg border-l-4 border-purple-500"><strong>Instrumental Variable (Z)</strong></div>
                        <div class="text-2xl text-gray-500 font-bold">&rarr;</div>
                        <div class="p-4 bg-green-100 rounded-lg border-l-4 border-green-500"><strong>Treatment (X)</strong></div>
                        <div class="text-2xl text-gray-500 font-bold">&rarr;</div>
                        <div class="p-4 bg-yellow-100 rounded-lg border-l-4 border-yellow-500"><strong>Outcome (Y)</strong></div>
                        <div class="absolute top-1/2 left-1/4 transform -translate-y-1/2 text-red-500 italic hidden sm:block">No direct path!</div>
                    </div>
                    <p class="text-gray-600 mt-4 text-center">Example: A classic instrument for estimating the effect of education (treatment) on earnings (outcome) is a person's proximity to a college. Proximity affects educational attainment but presumably not earnings directly.</p>
                </div>
            </div>
        </section>

        <hr class="my-16 border-gray-200">

        <section id="lab" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-2">Interactive Lab: Build a Causal Diagram</h2>
             <p class="max-w-3xl mx-auto text-center text-lg text-gray-600 mb-8">
                Causal relationships are often mapped using <span class="font-semibold text-blue-600">Directed Acyclic Graphs (DAGs)</span>. These diagrams help us visualize our assumptions about the world. Build your own DAG to understand concepts like confounding, mediation, and collision.
            </p>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Your Toolbox</h3>
                    <div id="node-palette" class="grid grid-cols-2 gap-2">
                        <div class="dag-node-palette-item bg-blue-100 text-blue-800 p-2 text-center rounded-md cursor-pointer hover:bg-blue-200" data-node="Smoking">Smoking</div>
                        <div class="dag-node-palette-item bg-blue-100 text-blue-800 p-2 text-center rounded-md cursor-pointer hover:bg-blue-200" data-node="Lung Cancer">Lung Cancer</div>
                        <div class="dag-node-palette-item bg-blue-100 text-blue-800 p-2 text-center rounded-md cursor-pointer hover:bg-blue-200" data-node="Genetics">Genetics</div>
                        <div class="dag-node-palette-item bg-blue-100 text-blue-800 p-2 text-center rounded-md cursor-pointer hover:bg-blue-200" data-node="Yellow Fingers">Yellow Fingers</div>
                        <div class="dag-node-palette-item bg-blue-100 text-blue-800 p-2 text-center rounded-md cursor-pointer hover:bg-blue-200" data-node="Asbestos">Asbestos</div>
                        <div class="dag-node-palette-item bg-blue-100 text-blue-800 p-2 text-center rounded-md cursor-pointer hover:bg-blue-200" data-node="Coughing">Coughing</div>
                    </div>
                    <div class="mt-6">
                        <h4 class="font-semibold mb-2">Instructions:</h4>
                        <ol class="list-decimal list-inside text-gray-600 space-y-1">
                            <li>Click a variable in the toolbox to add it to the canvas.</li>
                            <li>Click a node on the canvas to select it (it will glow).</li>
                            <li>Click a second node to draw a causal arrow from the first to the second.</li>
                            <li>To remove a node or arrow, double-click it.</li>
                        </ol>
                    </div>
                    <button id="reset-dag-btn" class="w-full mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Reset Canvas</button>
                </div>
                <div id="dag-canvas-container" class="lg:col-span-2 bg-white rounded-lg shadow-lg relative overflow-hidden">
                    <canvas id="dag-lines-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>
                    <div id="dag-nodes-container" class="absolute top-0 left-0 w-full h-full"></div>
                </div>
            </div>
        </section>
        
        <hr class="my-16 border-gray-200">

        <section id="quiz" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-2">Test Your Knowledge</h2>
            <p class="max-w-3xl mx-auto text-center text-lg text-gray-600 mb-8">
                Let's see what you've learned. Answer these questions to check your understanding of the core concepts.
            </p>
            <div id="quiz-container" class="max-w-2xl mx-auto bg-white p-6 sm:p-8 rounded-lg shadow-lg">
                <div id="quiz-question-container">
                    <p id="quiz-progress" class="text-sm text-gray-500 mb-2"></p>
                    <h3 id="quiz-question" class="text-2xl font-bold text-gray-800 mb-6"></h3>
                    <div id="quiz-options" class="space-y-3"></div>
                </div>
                <div id="quiz-results-container" class="hidden text-center">
                    <h3 class="text-3xl font-bold text-gray-800 mb-4">Quiz Complete!</h3>
                    <p id="quiz-score" class="text-xl text-gray-600 mb-2"></p>
                    <p id="quiz-feedback" class="text-lg font-semibold mb-6"></p>
                    <button id="quiz-retry-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                        Try Again
                    </button>
                </div>
                <div class="mt-6 text-right">
                    <button id="quiz-next-btn" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-2 px-4 rounded-lg transition duration-300 hidden">
                        Next Question &rarr;
                    </button>
                </div>
            </div>
        </section>

        <hr class="my-16 border-gray-200">

        <section id="challenges" class="my-12 scroll-mt-20">
            <h2 class="text-4xl font-bold text-center text-gray-900 mb-2">Challenges and Frontiers</h2>
            <p class="max-w-3xl mx-auto text-center text-lg text-gray-600 mb-8">
                Causal inference is powerful, but not magic. It relies on critical assumptions that must be justified with domain knowledge.
            </p>
            <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Unobserved Confounding</h3>
                    <p class="text-gray-600">The biggest challenge. If we fail to measure a common cause of both the treatment and the outcome, our estimates will be biased. This is why careful study design and thinking through a causal diagram (DAG) is so important.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Generalizability</h3>
                    <p class="text-gray-600">A causal effect estimated in one population (e.g., college students in the US) may not apply to another (e.g., elderly farmers in Japan). Understanding the context of an analysis is crucial for knowing how far its conclusions can be stretched.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Measurement Error</h3>
                    <p class="text-gray-600">If our variables are not measured accurately, it can introduce noise and bias into our results. A survey question might be poorly worded, or a sensor might be miscalibrated, leading to faulty conclusions.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">The Future: Causal AI</h3>
                    <p class="text-gray-600">The intersection of machine learning and causal inference is a rapidly growing field. Researchers are developing algorithms that can discover causal relationships from data and help make more robust, fair, and reliable predictions.</p>
                </div>
            </div>
        </section>

    </main>

<!--

    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center">
            <p>&copy; 2025 Interactive Guide to Causal Inference. Created to make complex ideas accessible.</p>
        </div>
    </footer>
-->

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Mobile menu
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            document.querySelectorAll('.mobile-nav-link').forEach(link => {
                link.addEventListener('click', () => mobileMenu.classList.add('hidden'));
            });

            // Smooth scrolling and active nav link highlighting
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                        });
                    }
                });
            }, { rootMargin: '-50% 0px -50% 0px', threshold: 0 });

            sections.forEach(section => observer.observe(section));
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // Tab functionality for methods section
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const target = tab.getAttribute('data-tab');
                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.id === target);
                    });
                });
            });

            // Chart 1: Correlation vs. Causation
            const correlationCtx = document.getElementById('correlationChart').getContext('2d');
            const confounderBtn = document.getElementById('confounder-btn');
            const explanationText = document.getElementById('explanation-text');

            const correlationData = {
                datasets: [{
                    label: 'Ice Cream Sales vs. Shark Attacks',
                    data: Array.from({length: 20}, () => ({x: Math.random() * 80 + 10, y: Math.random() * 80 + 10})).sort((a,b) => a.x - b.x).map((p, i) => ({x: p.x, y: p.x * (0.8 + Math.random()*0.4) - 5})),
                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    pointRadius: 6,
                }]
            };

            const correlationChart = new Chart(correlationCtx, {
                type: 'scatter',
                data: correlationData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Ice Cream Sales' } },
                        y: { title: { display: true, text: 'Shark Attacks' } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) { return 'Click the button below!'; }
                            }
                        }
                    }
                }
            });

            confounderBtn.addEventListener('click', () => {
                correlationChart.data.datasets.push({
                    label: 'Effect of Temperature',
                    data: correlationChart.data.datasets[0].data,
                    backgroundColor: 'rgba(239, 68, 68, 0.5)',
                    borderColor: 'rgba(239, 68, 68, 1)',
                    pointRadius: 6
                });
                correlationChart.data.datasets.shift();
                correlationChart.update();
                explanationText.classList.remove('hidden');
                confounderBtn.textContent = 'Confounder Revealed!';
                confounderBtn.disabled = true;
                confounderBtn.classList.add('bg-gray-400');
                confounderBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            });

            // Chart 2: Difference-in-Differences
            const didCtx = document.getElementById('didChart').getContext('2d');
            const didBtn = document.getElementById('did-btn');
            const didResetBtn = document.getElementById('did-reset-btn');
            
            const didInitialData = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
                datasets: [{
                    label: 'Treatment Group',
                    data: [20, 22, 21, 23, 24, 25, null, null],
                    borderColor: 'rgba(239, 68, 68, 1)',
                    backgroundColor: 'rgba(239, 68, 68, 0.2)',
                    fill: false,
                    tension: 0.1,
                }, {
                    label: 'Control Group',
                    data: [18, 19, 20, 20, 21, 22, 22.5, 23],
                    borderColor: 'rgba(59, 130, 246, 1)',
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    fill: false,
                    tension: 0.1,
                }]
            };
            
            let didChart;

            function createDidChart() {
                if(didChart) didChart.destroy();
                didChart = new Chart(didCtx, {
                    type: 'line',
                    data: JSON.parse(JSON.stringify(didInitialData)),
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Month' } },
                            y: { title: { display: true, text: 'Outcome' }, beginAtZero: false }
                        },
                        plugins: {
                            title: { display: true, text: 'Outcome Trends Over Time' },
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        xMin: 4.5, xMax: 4.5,
                                        borderColor: 'rgb(0, 0, 0)', borderWidth: 2, borderDash: [6, 6],
                                        label: { content: 'Intervention', enabled: true, position: 'start' }
                                    }
                                }
                            }
                        }
                    }
                });
            }
            createDidChart();

            didBtn.addEventListener('click', () => {
                const treatmentData = didChart.data.datasets[0].data;
                treatmentData[5] = 25;
                treatmentData[6] = 30;
                treatmentData[7] = 32;

                const counterfactualData = [null, null, null, null, null, 25, 25.5, 26];

                if (didChart.data.datasets.length < 3) {
                    didChart.data.datasets.push({
                        label: 'Counterfactual',
                        data: counterfactualData,
                        borderColor: 'rgba(239, 68, 68, 0.5)',
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.1,
                    });
                }
                didChart.update();
                didBtn.disabled = true;
            });
            
            didResetBtn.addEventListener('click', () => {
                createDidChart();
                didBtn.disabled = false;
            });


            // Chart 3: Regression Discontinuity
            const rddCtx = document.getElementById('rddChart').getContext('2d');
            const rddData = {
                datasets: [{
                    label: 'Below Threshold (Control)',
                    data: Array.from({length: 30}, () => ({x: Math.random() * 49, y: 10 + Math.random() * 20 + (Math.random() * 50)})),
                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                    type: 'scatter'
                }, {
                    label: 'Above Threshold (Treatment)',
                    data: Array.from({length: 30}, () => ({x: 51 + Math.random() * 49, y: 30 + Math.random() * 20 + (Math.random() * 50)})),
                    backgroundColor: 'rgba(239, 68, 68, 0.5)',
                    type: 'scatter'
                },{
                    label: 'Trend (Control)',
                    data: [{x:0, y:35}, {x:50, y:60}],
                    borderColor: 'rgba(59, 130, 246, 1)',
                    type: 'line',
                    fill: false,
                    pointRadius: 0
                },{
                    label: 'Trend (Treatment)',
                    data: [{x:50, y:80}, {x:100, y:105}],
                    borderColor: 'rgba(239, 68, 68, 1)',
                    type: 'line',
                    fill: false,
                    pointRadius: 0
                }]
            };

            new Chart(rddCtx, {
                data: rddData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Assignment Variable (e.g., Test Score)' } },
                        y: { title: { display: true, text: 'Outcome (e.g., Success Metric)' } }
                    },
                    plugins: {
                        title: { display: true, text: 'Effect at the Cutoff' },
                        legend: { display: true },
                        annotation: {
                             annotations: {
                                line1: {
                                    type: 'line',
                                    xMin: 50, xMax: 50,
                                    borderColor: 'rgb(0, 0, 0)', borderWidth: 3,
                                    label: { content: 'Cutoff', enabled: true, position: 'end'}
                                }
                            }
                        }
                    }
                }
            });
            
             // DAG Lab Functionality
            const palette = document.getElementById('node-palette');
            const nodesContainer = document.getElementById('dag-nodes-container');
            const linesCanvas = document.getElementById('dag-lines-canvas');
            const canvasContainer = document.getElementById('dag-canvas-container');
            const resetDagBtn = document.getElementById('reset-dag-btn');
            const ctx = linesCanvas.getContext('2d');

            let nodes = [];
            let arrows = [];
            let selectedNode = null;
            let nodeIdCounter = 0;

            function resizeCanvas() {
                linesCanvas.width = canvasContainer.clientWidth;
                linesCanvas.height = canvasContainer.clientHeight;
                drawArrows();
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            palette.addEventListener('click', e => {
                if (e.target.classList.contains('dag-node-palette-item')) {
                    const nodeName = e.target.dataset.node;
                    createNode(nodeName, Math.random() * (canvasContainer.clientWidth - 100) + 50, Math.random() * (canvasContainer.clientHeight - 40) + 20);
                }
            });
            
            function createNode(name, x, y) {
                const node = { id: nodeIdCounter++, name, x, y, el: document.createElement('div') };
                node.el.className = 'dag-node absolute bg-white border-2 border-gray-400 rounded-lg p-2 shadow-md select-none';
                node.el.textContent = name;
                node.el.style.left = `${x - node.el.offsetWidth / 2}px`;
                node.el.style.top = `${y - node.el.offsetHeight / 2}px`;
                node.el.dataset.id = node.id;
                
                nodes.push(node);
                nodesContainer.appendChild(node.el);
                
                node.el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleNodeClick(node);
                });

                node.el.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    removeNode(node.id);
                });

                let isDragging = false;
                let dragOffsetX, dragOffsetY;

                node.el.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    dragOffsetX = e.clientX - node.el.offsetLeft;
                    dragOffsetY = e.clientY - node.el.offsetTop;
                    node.el.style.cursor = 'grabbing';
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        const containerRect = canvasContainer.getBoundingClientRect();
                        let clientX = e.clientX;
                        let clientY = e.clientY;

                        node.x = clientX - containerRect.left - (node.el.offsetWidth / 2);
                        node.y = clientY - containerRect.top - (node.el.offsetHeight / 2);

                        node.el.style.left = `${node.x}px`;
                        node.el.style.top = `${node.y}px`;

                        drawArrows();
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                     if (node.el) node.el.style.cursor = 'pointer';
                });
            }

            function handleNodeClick(node) {
                if (!selectedNode) {
                    selectedNode = node;
                    node.el.classList.add('selected');
                } else {
                    if (selectedNode.id !== node.id) {
                        createArrow(selectedNode, node);
                    }
                    selectedNode.el.classList.remove('selected');
                    selectedNode = null;
                }
            }

            function createArrow(fromNode, toNode) {
                if (!arrows.some(a => a.from === fromNode.id && a.to === toNode.id)) {
                    arrows.push({ from: fromNode.id, to: toNode.id });
                    drawArrows();
                }
            }
            
            function getCenter(node) {
                const el = node.el;
                return { x: el.offsetLeft + el.offsetWidth / 2, y: el.offsetTop + el.offsetHeight / 2 };
            }

            function drawArrows() {
                ctx.clearRect(0, 0, linesCanvas.width, linesCanvas.height);
                arrows.forEach(arrow => {
                    const fromNode = nodes.find(n => n.id === arrow.from);
                    const toNode = nodes.find(n => n.id === arrow.to);
                    if (fromNode && toNode) {
                        const start = getCenter(fromNode);
                        const end = getCenter(toNode);
                        drawArrow(ctx, start.x, start.y, end.x, end.y);
                    }
                });
            }

            function drawArrow(ctx, fromx, fromy, tox, toy) {
                const headlen = 10;
                const dx = tox - fromx;
                const dy = toy - fromy;
                const angle = Math.atan2(dy, dx);
                ctx.beginPath();
                ctx.moveTo(fromx, fromy);
                ctx.lineTo(tox, toy);
                ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
                ctx.moveTo(tox, toy);
                ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
                ctx.strokeStyle = '#374151';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            function removeNode(nodeId) {
                nodes = nodes.filter(n => {
                    if (n.id === nodeId) {
                        n.el.remove();
                        return false;
                    }
                    return true;
                });
                arrows = arrows.filter(a => a.from !== nodeId && a.to !== nodeId);
                drawArrows();
            }
            
            function removeArrow(fromId, toId) {
                arrows = arrows.filter(a => !(a.from === fromId && a.to === toId));
                drawArrows();
            }

            linesCanvas.addEventListener('dblclick', e => {
                 const mouseX = e.offsetX;
                 const mouseY = e.offsetY;

                for (let i = arrows.length - 1; i >= 0; i--) {
                    const arrow = arrows[i];
                    const fromNode = nodes.find(n => n.id === arrow.from);
                    const toNode = nodes.find(n => n.id === arrow.to);
                    if (fromNode && toNode) {
                        const start = getCenter(fromNode);
                        const end = getCenter(toNode);
                        
                        const dist = Math.abs((end.y - start.y) * mouseX - (end.x - start.x) * mouseY + end.x * start.y - end.y * start.x) / Math.sqrt(Math.pow(end.y - start.y, 2) + Math.pow(end.x - start.x, 2));
                        
                        if (dist < 5) {
                            removeArrow(arrow.from, arrow.to);
                            return; 
                        }
                    }
                }
            });

            resetDagBtn.addEventListener('click', () => {
                nodes.forEach(n => n.el.remove());
                nodes = [];
                arrows = [];
                selectedNode = null;
                nodeIdCounter = 0;
                drawArrows();
            });

            document.body.addEventListener('click', (e) => {
                if (selectedNode && !e.target.classList.contains('dag-node')) {
                    selectedNode.el.classList.remove('selected');
                    selectedNode = null;
                }
            });

            // Quiz Functionality
            const quizData = [
                {
                    question: "In the 'Ice Cream Sales vs. Shark Attacks' example, what is the confounding variable?",
                    options: ["The price of ice cream", "The number of lifeguards on duty", "High temperatures", "The species of shark"],
                    correctAnswer: 2
                },
                {
                    question: "Which method is considered the 'gold standard' for causal inference because it minimizes confounding?",
                    options: ["Difference-in-Differences", "Regression Discontinuity", "Instrumental Variables", "Randomized Controlled Trials (RCTs)"],
                    correctAnswer: 3
                },
                {
                    question: "Regression Discontinuity (RDD) is most useful when a treatment is assigned based on what?",
                    options: ["A random lottery", "A specific cutoff or threshold", "The researcher's choice", "The participant's preference"],
                    correctAnswer: 1
                },
                {
                    question: "In a Directed Acyclic Graph (DAG), what does an arrow from A to B represent?",
                    options: ["A and B are correlated", "A causes B", "A and B are measured at the same time", "A is a confounder for B"],
                    correctAnswer: 1
                },
                {
                    question: "Difference-in-Differences (DiD) estimates a causal effect by comparing the change in outcomes over time between which two groups?",
                    options: ["A treatment group and a different treatment group", "A treatment group and a control group", "Two groups before any treatment", "Two groups after a treatment"],
                    correctAnswer: 1
                }
            ];

            const quizQuestionContainer = document.getElementById('quiz-question-container');
            const quizResultsContainer = document.getElementById('quiz-results-container');
            const questionEl = document.getElementById('quiz-question');
            const optionsEl = document.getElementById('quiz-options');
            const nextBtn = document.getElementById('quiz-next-btn');
            const retryBtn = document.getElementById('quiz-retry-btn');
            const progressEl = document.getElementById('quiz-progress');
            const scoreEl = document.getElementById('quiz-score');
            const feedbackEl = document.getElementById('quiz-feedback');

            let currentQuestionIndex = 0;
            let score = 0;

            function startQuiz() {
                currentQuestionIndex = 0;
                score = 0;
                quizQuestionContainer.classList.remove('hidden');
                quizResultsContainer.classList.add('hidden');
                nextBtn.classList.add('hidden');
                showQuestion();
            }

            function showQuestion() {
                resetState();
                const currentQuestion = quizData[currentQuestionIndex];
                questionEl.innerText = currentQuestion.question;
                progressEl.innerText = `Question ${currentQuestionIndex + 1} of ${quizData.length}`;

                currentQuestion.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.innerText = option;
                    button.classList.add('quiz-option', 'w-full', 'p-3', 'text-left', 'border-2', 'rounded-lg', 'bg-gray-100', 'border-gray-200');
                    button.dataset.index = index;
                    button.addEventListener('click', selectAnswer);
                    optionsEl.appendChild(button);
                });
            }

            function resetState() {
                nextBtn.classList.add('hidden');
                while (optionsEl.firstChild) {
                    optionsEl.removeChild(optionsEl.firstChild);
                }
            }

            function selectAnswer(e) {
                const selectedButton = e.target;
                const selectedAnswerIndex = parseInt(selectedButton.dataset.index);
                const correctAnswerIndex = quizData[currentQuestionIndex].correctAnswer;

                if (selectedAnswerIndex === correctAnswerIndex) {
                    score++;
                }

                Array.from(optionsEl.children).forEach((button, index) => {
                    button.classList.add('disabled');
                    if (index === correctAnswerIndex) {
                        button.classList.add('correct');
                    } else if (index === selectedAnswerIndex) {
                        button.classList.add('incorrect');
                    }
                });

                nextBtn.classList.remove('hidden');
            }

            function showResults() {
                quizQuestionContainer.classList.add('hidden');
                quizResultsContainer.classList.remove('hidden');
                scoreEl.innerText = `You scored ${score} out of ${quizData.length}!`;
                
                let feedback = "";
                if (score === quizData.length) {
                    feedback = "Excellent! You're a causal inference expert.";
                } else if (score >= quizData.length * 0.7) {
                    feedback = "Great job! You have a strong grasp of the concepts.";
                } else if (score >= quizData.length * 0.4) {
                    feedback = "Good start! Reviewing the sections might be helpful.";
                } else {
                    feedback = "Time for a review! The answers are in the guide.";
                }
                feedbackEl.innerText = feedback;
            }

            nextBtn.addEventListener('click', () => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizData.length) {
                    showQuestion();
                } else {
                    showResults();
                }
            });

            retryBtn.addEventListener('click', startQuiz);

            startQuiz();

        });
    </script>
</body>
</html>
